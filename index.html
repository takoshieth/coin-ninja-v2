<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>Coin Ninja</title>
  <!-- âœ… Farcaster MiniApp Metadata -->
  <meta name="fc:miniapp" content='{
    "version": "1",
    "imageUrl": "https://coin-ninja-v2.vercel.app/og.png",
    "button": {
      "title": "Play Now",
      "action": {
        "type": "launch_miniapp",
        "name": "Coin Ninja",
        "url": "https://coin-ninja-v2.vercel.app"
      }
    }
  }' />
  <!-- âœ… Backward compatibility -->
  <meta name="fc:frame" content='{
    "version": "1",
    "imageUrl": "https://coin-ninja-v2.vercel.app/og.png",
    "button": {
      "title": "Play Now",
      "action": {
        "type": "launch_frame",
        "name": "Coin Ninja",
        "url": "https://coin-ninja-v2.vercel.app",
        "splashImageUrl": "https://coin-ninja-v2.vercel.app/assets/logo.png",
        "splashBackgroundColor": "#0e1116"
      }
    }
  }' />  
  <link rel="stylesheet" href="style.css" />

  <!-- âœ… Farcaster MiniApp SDK -->
<script type="module">
  import { sdk } from "https://esm.sh/@farcaster/miniapp-sdk";
  window.farcasterSDK = sdk;

  async function setupFarcaster() {
    try {
      await sdk.actions.ready();
      console.log("âœ… Farcaster SDK ready()");
    } catch (err) {
      console.warn("âš ï¸ Farcaster SDK not available:", err);
    }
  }

  window.addEventListener("load", setupFarcaster);
</script>

    });
  </script>
</head>
<body>
  <div id="app">
    <!-- ğŸ” TOP BAR -->
    <div class="topbar">
      <img src="assets/logo.png" alt="Coin Ninja" class="logo-small" />
      <div class="buttons">
        <button id="btnHow">How to Play</button>
        <button id="btnLeaderboard">Leaderboard</button>
      </div>
    </div>

    <!-- ğŸ  MAIN MENU -->
    <div id="menu" class="panel">
      <img src="assets/logo.png" alt="Coin Ninja Logo" class="logo-large" />
      <h1>Coin Ninja</h1>
      <p class="tagline">Slice the coins. Avoid the <strong>DUMP</strong> bomb.</p>

      <div class="nft-info">
        <p><strong>Daily Leaderboard Reward:</strong><br>
        Each dayâ€™s #1 player wins <span class="highlight">1 Virgen Club NFT!</span></p>
        <div class="opensea-link">
          <a href="https://opensea.io/collection/thevirgenclub" target="_blank">
            <img src="assets/opensea.png" alt="OpenSea" />
          </a>
        </div>
      </div>

      <button id="btnStart" class="primary">Start Game</button>
      <div class="credits">Created by <a href="https://twitter.com/takoshieth" target="_blank">@takoshieth</a></div>
    </div>

    <!-- ğŸ® HUD -->
    <div id="hud" class="hud hidden">
      <div class="score">Score: <span id="score">0</span></div>
      <div class="combo" id="combo">Combo x1</div>
      <div class="lives" id="lives">ğŸ’šğŸ’šğŸ’š</div>
    </div>

    <!-- ğŸ•¹ï¸ GAME CANVAS -->
    <canvas id="game" style="touch-action:none;-ms-touch-action:none;"></canvas>

    <!-- ğŸ’¥ GAME OVER -->
    <div id="gameover" class="panel hidden">
      <h2>Game Over ğŸ’¥</h2>
      <p>Your Score: <span id="finalScore">0</span></p>
      <form id="saveForm">
        <div class="row">
          <label>Twitter Username</label>
          <input id="twitter" type="text" placeholder="@nickname" required/>
        </div>
        <div class="row">
          <label>Wallet Address</label>
          <input id="wallet" type="text" placeholder="0x..." />
        </div>
        <div class="buttons">
          <button type="submit" class="primary">Save to Leaderboard</button>
          <button id="btnDownloadImage" type="button">Download Score Image</button>
          <button id="btnShare" type="button">Share on Twitter</button>
        </div>
      </form>
      <div class="buttons mt">
        <button id="btnRestart">Play Again</button>
        <button id="btnMenu">Main Menu</button>
      </div>
    </div>

    <!-- ğŸ“˜ HOW TO PLAY -->
    <div id="modalHow" class="modal hidden">
      <div class="modal-content">
        <h3>How to Play</h3>
        <ul>
          <li>Swipe to slice coins â€” but avoid the <strong>DUMP</strong> bomb.</li>
          <li>You start with <strong>3 lives ğŸ’šğŸ’šğŸ’š</strong>.</li>
          <li>Each missed coin costs 1 life. When all lives are gone â€” game over!</li>
          <li>Slicing multiple same-type coins in one move gives COMBO bonus.</li>
          <li>Difficulty increases over time â€” stay sharp!</li>
        </ul>
        <button id="closeHow">Close</button>
      </div>
    </div>

    <!-- ğŸ† LEADERBOARD -->
    <div id="modalLeaderboard" class="modal hidden">
      <div class="modal-content">
        <div class="tabs">
          <button id="tabLeaderboard" class="tab active">Leaderboard</button>
          <button id="tabWinners" class="tab"><span class="crown">ğŸ‘‘</span> Daily Winners</button>
        </div>
        <div id="leaderboardContent">
          <ol id="lbList"></ol>
        </div>
        <div id="winnersContent" class="hidden">
          <ol id="winnersList"></ol>
        </div>
        <button id="closeLb">Close</button>
      </div>
    </div>
  </div>

  <!-- âœ… Farcaster SDK HazÄ±r Olmadan KV GÃ¼ncellemelerini Engelle -->
  <script>
    window.addEventListener("load", () => {
      console.log("âœ… Page fully loaded â€” ready for KV integration");
    });
  </script>

  <!-- âœ… KV / Game Script -->
  <script defer src="game.js"></script>
</body>
</html>
